<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.60">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/favicon.png"><title>How it works | Parabox</title><meta name="description" content="User documentation and development documentation of Parabox.">
    <link rel="preload" href="/assets/style-fae0be7d.css" as="style"><link rel="stylesheet" href="/assets/style-fae0be7d.css">
    <link rel="modulepreload" href="/assets/app-2d8419d4.js"><link rel="modulepreload" href="/assets/framework-204010b2.js"><link rel="modulepreload" href="/assets/how-it-works.html-bbf489c2.js"><link rel="modulepreload" href="/assets/how-it-works.html-d19c2181.js"><link rel="prefetch" href="/assets/developer.html-3af3bdda.js" as="script"><link rel="prefetch" href="/assets/faq.html-d9097bdb.js" as="script"><link rel="prefetch" href="/assets/how-it-works.html-29331dc3.js" as="script"><link rel="prefetch" href="/assets/index.html-dfe14ef6.js" as="script"><link rel="prefetch" href="/assets/parabox-development-kit.html-bd67a8e2.js" as="script"><link rel="prefetch" href="/assets/privacy.html-033f2cd4.js" as="script"><link rel="prefetch" href="/assets/quick-start.html-5e001fd5.js" as="script"><link rel="prefetch" href="/assets/terms.html-a6f89da4.js" as="script"><link rel="prefetch" href="/assets/developer.html-1f117d1c.js" as="script"><link rel="prefetch" href="/assets/faq.html-9c448633.js" as="script"><link rel="prefetch" href="/assets/index.html-8a2a46e2.js" as="script"><link rel="prefetch" href="/assets/privacy.html-0831415d.js" as="script"><link rel="prefetch" href="/assets/quick-start.html-2c2709f0.js" as="script"><link rel="prefetch" href="/assets/terms.html-bea71aba.js" as="script"><link rel="prefetch" href="/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/assets/developer.html-de617657.js" as="script"><link rel="prefetch" href="/assets/faq.html-3978a4c0.js" as="script"><link rel="prefetch" href="/assets/how-it-works.html-e2f0db04.js" as="script"><link rel="prefetch" href="/assets/index.html-e4a5ae15.js" as="script"><link rel="prefetch" href="/assets/parabox-development-kit.html-8667eb06.js" as="script"><link rel="prefetch" href="/assets/privacy.html-9e5807d8.js" as="script"><link rel="prefetch" href="/assets/quick-start.html-e69c9373.js" as="script"><link rel="prefetch" href="/assets/terms.html-324eb609.js" as="script"><link rel="prefetch" href="/assets/developer.html-547c3f41.js" as="script"><link rel="prefetch" href="/assets/faq.html-c0e747c9.js" as="script"><link rel="prefetch" href="/assets/index.html-5155efce.js" as="script"><link rel="prefetch" href="/assets/privacy.html-1e6a8a2e.js" as="script"><link rel="prefetch" href="/assets/quick-start.html-66654763.js" as="script"><link rel="prefetch" href="/assets/terms.html-f2b4cb51.js" as="script"><link rel="prefetch" href="/assets/404.html-d1e63d77.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/en/" class=""><img class="logo" src="/images/app.png" alt="Parabox"><span class="site-name can-hide">Parabox</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Welcome"><span class="title">Welcome</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Welcome"><span class="title">Welcome</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/en/" class="" aria-label="Welcome"><!--[--><!--]--> Welcome <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/how-it-works/" class="" aria-label="How it works"><!--[--><!--]--> How it works <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/terms/" class="" aria-label="Terms of Service"><!--[--><!--]--> Terms of Service <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/privacy/" class="" aria-label="Privacy Policy"><!--[--><!--]--> Privacy Policy <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/en/quick-start/" class="" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a></div><div class="navbar-item"><a href="/en/faq/" class="" aria-label="FAQ"><!--[--><!--]--> FAQ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Developer Docs"><span class="title">Developer Docs</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Developer Docs"><span class="title">Developer Docs</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/en/developer/" class="" aria-label="Developer Docs"><!--[--><!--]--> Developer Docs <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/parabox-development-kit/" class="" aria-label="SDK Docs"><!--[--><!--]--> SDK Docs <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/how-it-works.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/en/how-it-works.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/Parabox-App/parabox" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Welcome"><span class="title">Welcome</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Welcome"><span class="title">Welcome</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/en/" class="" aria-label="Welcome"><!--[--><!--]--> Welcome <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/how-it-works/" class="" aria-label="How it works"><!--[--><!--]--> How it works <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/terms/" class="" aria-label="Terms of Service"><!--[--><!--]--> Terms of Service <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/privacy/" class="" aria-label="Privacy Policy"><!--[--><!--]--> Privacy Policy <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/en/quick-start/" class="" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a></div><div class="navbar-item"><a href="/en/faq/" class="" aria-label="FAQ"><!--[--><!--]--> FAQ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Developer Docs"><span class="title">Developer Docs</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Developer Docs"><span class="title">Developer Docs</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/en/developer/" class="" aria-label="Developer Docs"><!--[--><!--]--> Developer Docs <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/parabox-development-kit/" class="" aria-label="SDK Docs"><!--[--><!--]--> SDK Docs <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/how-it-works.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/en/how-it-works.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/Parabox-App/parabox" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">How it works <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/en/how-it-works.html#interprocess-communication" class="router-link-active router-link-exact-active sidebar-item" aria-label="Interprocess communication"><!--[--><!--]--> Interprocess communication <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/en/how-it-works.html#message-caching" class="router-link-active router-link-exact-active sidebar-item" aria-label="Message caching"><!--[--><!--]--> Message caching <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/en/how-it-works.html#fcm" class="router-link-active router-link-exact-active sidebar-item" aria-label="FCM"><!--[--><!--]--> FCM <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/en/how-it-works.html#database" class="router-link-active router-link-exact-active sidebar-item" aria-label="Database"><!--[--><!--]--> Database <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="how-it-works" tabindex="-1"><a class="header-anchor" href="#how-it-works" aria-hidden="true">#</a> How it works</h1><blockquote><p>This part deals with some more complex working principles. General users can jump to read <a href="/quick-start">Quick Start</a>.</p></blockquote><h2 id="interprocess-communication" tabindex="-1"><a class="header-anchor" href="#interprocess-communication" aria-hidden="true">#</a> Interprocess communication</h2><p>Parabox relies on a <strong>client</strong> to work in conjunction with a <strong>plugin</strong>. Running it alone won&#39;t work.</p><p>Clients and plugins run in separate processes. Communication between different processes relies on <a href="https://developer.android.com/reference/android/os/Messenger" target="_blank" rel="noopener noreferrer"><strong>Messenger</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. The plug-in acts as the server, the client acts as the client, and the client can connect to multiple plug-ins at the same time. In general, when the client starts, Parabox performs the following operations in sequence:</p><ol><li>Use IntentFilter to filter out the plug-ins that meet the specification and add them to the temporary plug-in list.</li><li>Perform the bindService operation on the plug-ins in the list in turn.</li><li>For the plug-in successfully connected, the client sends an initialization request. The plug-in is initialized according to the request and combined with the current running state (such as starting the service).</li><li>Every time the plug-in changes state (start, stop, pause, resume, etc.), it will send a notification to the client. The client updates the plug-in status display according to the notification content. This status monitoring will continue for the entire run cycle.</li><li>When the plugin returns a status of running, the client considers it a stable connection.</li></ol><p>The above processes have been encapsulated into methods that can be easily called, and developers do not need to care about the details.</p><blockquote><p>In particular, for every <strong>REQUEST</strong> that is received, the verification is required to be sent back with a timestamp. Requests that do not return within a timeout will be considered invalid and return a timeout error.</p><p><strong>NOTIFICATION</strong> does not require postback verification, but still requires a timestamp.</p><p>All encapsulation methods in the development kit, including message sending/receiving, status update, setting item update, etc., use the above two methods to communicate.</p></blockquote><h2 id="message-caching" tabindex="-1"><a class="header-anchor" href="#message-caching" aria-hidden="true">#</a> Message caching</h2><p>Messages may be lost due to special reasons such as poor connection, client service being killed, etc. To avoid this situation, Parabox provides a caching mechanism for messages to be received.</p><p>Each message is communicated internally using the <strong>REQUEST</strong> method. The plugin maintains a buffer queue of pending messages. The plugin removes all messages from the queue and tries to send them to the client. If the message is successfully received and stored by the client, the client will send a confirmation loopback verification to the plugin, otherwise, it will send a loopback verification with an error code. If the plug-in receives the confirmation of the return verification, the current transmission is successful and it will be removed from the queue; if an error is received or a timeout error is triggered, the message will be re-added to the to-be-received message buffer queue, waiting for the next transmission. If an error is received multiple times, it is judged that the client is disconnected, and the above loop is suspended until the client reconnects and triggers a refresh.</p><p>If the plugin service is killed, the caching mechanism will fail and messages will be lost.</p><p>The above processes have been encapsulated into methods that can be easily called, and developers do not need to care about the details.</p><h2 id="fcm" tabindex="-1"><a class="header-anchor" href="#fcm" aria-hidden="true">#</a> FCM</h2><p>Due to the inherent defects of the cross-process communication method, the plug-in and the client need to keep the service running at the same time to ensure smooth communication. (Plugin service is used for message reception, client service is used for notification push and database insertion)</p><p>Through FCM, users can first choose to run the above services on other devices (such as standby machines), and then transmit message packets to the main machine through FCM. Since the FCM message reception is maintained by the system, no additional background services need to be run on the main machine, so that the cost of message reception can be passed on.</p><h2 id="database" tabindex="-1"><a class="header-anchor" href="#database" aria-hidden="true">#</a> Database</h2><p>Parabox mainly maintains four types of data: <strong>Contact, Message, File, PluginConnection</strong>. Each type of data has its own unique id, which is provided by the plugin. In the actual storage, the plug-in id is usually attached to distinguish the data of different plug-ins. Each type also has a common type (Model) and an entity type (Entity).</p><table><thead><tr><th>Data Type</th><th>Content</th><th>Remarks</th></tr></thead><tbody><tr><td>Contact</td><td>Abstraction of contacts (does not distinguish between groups and private chats), including account information such as name, avatar and various configuration information</td><td>many-to-many binding with PluginConnection</td></tr><tr><td>Message</td><td>Abstract of message, including message content, sender account information</td><td>One-to-one binding with connection</td></tr><tr><td>File</td><td>Abstraction of files, including file name, file size, file type, download/backup method, etc.</td><td>One-to-one binding with messages</td></tr><tr><td>PluginConnection</td><td>The connection information between the plug-in and the client, mainly including the connection data required for sending messages. Also used to determine session type</td><td>many-to-many binding with sessions</td></tr></tbody></table><p>For more implementation details, please read <a href="/en/developer">Developer Documentation</a>.</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ojhdtmail@gmail.com">ojhdt</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-2d8419d4.js" defer></script>
  </body>
</html>
